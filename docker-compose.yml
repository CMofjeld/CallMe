version: '3'

services:
  client:
    image: 'carlanders/callme-client'
    build:
      dockerfile: Dockerfile.dev
      context: ./callme-client
    depends_on:
      - user
    environment:
      - REACT_APP_API_HOSTNAME=localhost:12345
  user:
    image: 'carlanders/callme-user-service'
    build:
      dockerfile: Dockerfile.dev
      context: ./user-service
    depends_on:
      - postgres
    environment:
      - DB_HOST_PORT=postgres:5432
      - DB_PASS=password
      - DB_USER=user
      - JWT_EXPIRE_MS=86400000
      - JWT_SECRET=secret
  postgres:
    image: 'postgres'
    environment:
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
  nginx:
    depends_on:
      - user
      - client
    restart: always
    build:
      dockerfile: Dockerfile.dev
      context: ./nginx
    ports:
      - '12345:80'